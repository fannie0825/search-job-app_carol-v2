<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerLens - AI Career Copilot for Hong Kong</title>
    <link rel="icon" type="image/svg+xml" href="/logo-icon.svg" />
    <!-- Permissions Policy: Suppress warnings for deprecated features -->
    <meta http-equiv="Permissions-Policy" content="ambient-light-sensor=(), battery=(), document-domain=(), layout-animations=(), legacy-image-formats=(), oversized-images=(), vr=(), wake-lock=()">
    <!-- Suppress WebSocket and non-critical console errors -->
    <script>
      // Suppress WebSocket connection errors from Streamlit Cloud (not applicable to React apps)
      (function() {
        const originalError = console.error;
        const originalWarn = console.warn;
        
        // Suppress console.error for non-critical errors
        console.error = function(...args) {
          const message = args.join(' ').toLowerCase();
          
          // Suppress WebSocket errors related to Streamlit Cloud
          if (message.includes('websocket') && (
            message.includes('logstream') || 
            message.includes('_stcore') ||
            message.includes('streamlit')
          )) {
            return; // Silently ignore Streamlit WebSocket connection attempts
          }
          
          // Suppress Permissions Policy warnings (handled by meta tag)
          if (message.includes('unrecognized feature') || 
              message.includes('permissions policy') ||
              message.includes('feature policy')) {
            return; // Silently ignore Permissions Policy warnings
          }
          
          // Suppress iframe sandbox warnings (from Streamlit Cloud infrastructure)
          if (message.includes('iframe') && (
            message.includes('sandbox') || 
            message.includes('allow-scripts') ||
            message.includes('allow-same-origin')
          )) {
            return; // Silently ignore iframe sandbox warnings
          }
          
          // Suppress Streamlit-specific endpoint errors
          if (message.includes('_stcore') || 
              message.includes('streamlit') ||
              message.includes('failed to load resource') && (
                message.includes('503') || 
                message.includes('404')
              )) {
            return; // Silently ignore Streamlit endpoint errors
          }
          
          // Suppress tracking prevention warnings (browser privacy features)
          if (message.includes('tracking prevention') || 
              message.includes('blocked access to storage')) {
            return; // Silently ignore browser privacy warnings
          }
          
          // Call original console.error for other errors
          originalError.apply(console, args);
        };
        
        // Suppress console.warn for non-critical warnings
        console.warn = function(...args) {
          const message = args.join(' ').toLowerCase();
          
          // Suppress Permissions Policy warnings
          if (message.includes('unrecognized feature') || 
              message.includes('permissions policy') ||
              message.includes('feature policy')) {
            return;
          }
          
          // Suppress iframe sandbox warnings
          if (message.includes('iframe') && message.includes('sandbox')) {
            return;
          }
          
          // Call original console.warn for other warnings
          originalWarn.apply(console, args);
        };
      })();
      
      // Suppress WebSocket connection attempts to Streamlit endpoints
      (function() {
        const originalWebSocket = window.WebSocket;
        window.WebSocket = function(url, protocols) {
          // Block WebSocket connections to Streamlit Cloud endpoints
          if (url && (
            url.includes('/logstream') || 
            url.includes('/_stcore') ||
            url.includes('streamlit.app')
          )) {
            // Return a mock WebSocket that does nothing
            const mockWs = {
              readyState: 3, // CLOSED
              CONNECTING: 0,
              OPEN: 1,
              CLOSING: 2,
              CLOSED: 3,
              url: url,
              protocol: '',
              extensions: '',
              binaryType: 'blob',
              close: function() {},
              send: function() {},
              addEventListener: function() {},
              removeEventListener: function() {},
              dispatchEvent: function() { return false; },
              onopen: null,
              onclose: null,
              onerror: null,
              onmessage: null
            };
            // Prevent connection attempts
            setTimeout(() => {
              if (mockWs.onerror) {
                try {
                  mockWs.onerror(new Event('error'));
                } catch (e) {}
              }
            }, 0);
            return mockWs;
          }
          return new originalWebSocket(url, protocols);
        };
      })();
      
      // Suppress fetch errors for Streamlit endpoints
      (function() {
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
          const url = typeof args[0] === 'string' ? args[0] : args[0]?.url || '';
          
          // Block fetch requests to Streamlit Cloud endpoints
          if (url && (
            url.includes('/_stcore') || 
            url.includes('/logstream') ||
            url.includes('streamlit.app') && (
              url.includes('/health') ||
              url.includes('/host-config')
            )
          )) {
            // Return a rejected promise that we catch silently
            return Promise.reject(new Error('Streamlit endpoint not available in React app'));
          }
          
          return originalFetch.apply(window, args).catch(err => {
            // Suppress errors for Streamlit endpoints
            const errorMessage = err.message?.toLowerCase() || '';
            if (errorMessage.includes('streamlit') || 
                errorMessage.includes('_stcore') ||
                errorMessage.includes('logstream')) {
              // Return a mock response instead of throwing
              return new Response(JSON.stringify({ error: 'Not available' }), {
                status: 404,
                statusText: 'Not Found',
                headers: { 'Content-Type': 'application/json' }
              });
            }
            throw err;
          });
        };
      })();
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
</body>
</html>
